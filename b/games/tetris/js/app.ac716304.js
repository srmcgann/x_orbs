(function(e){function t(t){for(var s,r,n=t[0],o=t[1],c=t[2],p=0,d=[];p<n.length;p++)r=n[p],Object.prototype.hasOwnProperty.call(i,r)&&i[r]&&d.push(i[r][0]),i[r]=0;for(s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s]);h&&h(t);while(d.length)d.shift()();return l.push.apply(l,c||[]),a()}function a(){for(var e,t=0;t<l.length;t++){for(var a=l[t],s=!0,n=1;n<a.length;n++){var o=a[n];0!==i[o]&&(s=!1)}s&&(l.splice(t--,1),e=r(r.s=a[0]))}return e}var s={},i={app:0},l=[];function r(t){if(s[t])return s[t].exports;var a=s[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=s,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(a,s,function(t){return e[t]}.bind(null,s));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="";var n=window["webpackJsonp"]=window["webpackJsonp"]||[],o=n.push.bind(n);n.push=t,n=n.slice();for(var c=0;c<n.length;c++)t(n[c]);var h=o;l.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"3c5e":function(e,t,a){"use strict";a("69ab")},"517b":function(e,t,a){},"56d7":function(e,t,a){"use strict";a.r(t);var s=a("7a23");function i(e,t,a,i,l,r){const n=Object(s["m"])("Main");return Object(s["j"])(),Object(s["b"])(n,{state:l.state},null,8,["state"])}const l=e=>(Object(s["l"])("data-v-961e8868"),e=e(),Object(s["k"])(),e),r={class:"main"},n={key:0,class:"controls",style:{width:"750px"}},o=l(()=>Object(s["e"])("option",{selected:"",value:"cyberpunk"},"cyberpunk",-1)),c=l(()=>Object(s["e"])("option",{value:"rainbows"},"rainbows",-1)),h=[o,c],p={key:0,style:{display:"inline-block"}},d={key:1,style:{display:"inline-block"}},b=["innerHTML"],u={style:{display:"inline-block"}},y=l(()=>Object(s["e"])("br",null,null,-1)),m={key:0,style:{color:"#0f8","font-size":"12px",position:"absolute","maring-top":"45px",width:"120px","margin-left":"-58px"}},f={class:"actionContainer"},g={ref:"mainCanvas",tabindex:"0"},j={class:"innerInputForm",style:{"margin-top":"-40px",background:"#6488",padding:"20px","border-radius":"50%","box-shadow":"0 0 100px 100px #6488",width:"300px"}},O={key:0,style:{color:"#8fa","font-size":"1.4em","line-height":"1em"}},k=l(()=>Object(s["e"])("br",null,null,-1)),x=l(()=>Object(s["e"])("span",{style:{"font-size":".8em"}},"challenged to a",-1)),w=l(()=>Object(s["e"])("br",null,null,-1)),N=l(()=>Object(s["e"])("br",null,null,-1)),v={key:1,style:{color:"#8fa"}},S=l(()=>Object(s["e"])("br",null,null,-1)),D=l(()=>Object(s["e"])("span",{style:{"font-size":"1.5em"}},"Tetris match!",-1)),T=l(()=>Object(s["e"])("br",null,null,-1)),P=l(()=>Object(s["e"])("br",null,null,-1)),M=l(()=>Object(s["e"])("br",null,null,-1)),C=["disabled","innerHTML"],A=l(()=>Object(s["e"])("br",null,null,-1)),B=l(()=>Object(s["e"])("br",null,null,-1)),J=l(()=>Object(s["e"])("br",null,null,-1)),G=l(()=>Object(s["e"])("br",null,null,-1)),R=l(()=>Object(s["e"])("br",null,null,-1)),I={key:1},L={key:0,style:{position:"absolute","z-index":"1000",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"#28a8","box-shadow":"0 0 100px 100px #28a8",padding:"20px","border-radius":"50%","font-size":"1em","margin-top":"0px",width:"350px"}},K={key:0,style:{"margin-top":"-30px"}},z={style:{color:"#fff","text-shadow":"2px 2px 2px #000"}},$={style:{"font-size":"3em","text-shadow":"0 0 10px #fff",color:"#0ff"}},H=l(()=>Object(s["e"])("br",null,null,-1)),E=l(()=>Object(s["e"])("br",null,null,-1)),U=l(()=>Object(s["e"])("br",null,null,-1)),F={style:{"font-size":".6em"}},q=l(()=>Object(s["e"])("br",null,null,-1)),W=l(()=>Object(s["e"])("br",null,null,-1)),V=l(()=>Object(s["e"])("span",{style:{"font-size":"2em"}},"game master",-1)),_=l(()=>Object(s["e"])("br",null,null,-1)),Y=l(()=>Object(s["e"])("br",null,null,-1)),X={key:1},Q=["innerHTML"],Z={key:1,style:{position:"absolute","z-index":"1000",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"#28a8","box-shadow":"0 0 100px 100px #28a8",padding:"40px","border-radius":"50%","font-size":".8em","margin-top":"-20px"}},ee={key:0},te=l(()=>Object(s["e"])("br",null,null,-1)),ae={key:1},se=["innerHTML"],ie={key:2},le={style:{position:"absolute","z-index":"1000",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"#f038","box-shadow":"0 0 100px 100px #f038",padding:"40px","border-radius":"50%","font-size":".8em","text-shadow":"2px 2px 2px #000","margin-top":"-30px"}},re=l(()=>Object(s["e"])("br",null,null,-1)),ne=l(()=>Object(s["e"])("br",null,null,-1)),oe={key:3,style:{position:"absolute","z-index":"1000",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"#86c8","box-shadow":"0 0 100px 100px #86c8",padding:"40px","border-radius":"50%","font-size":".8em","text-shadow":"2px 2px 2px #000"}},ce=l(()=>Object(s["e"])("br",null,null,-1)),he=l(()=>Object(s["e"])("br",null,null,-1)),pe=["innerHTML"],de=l(()=>Object(s["e"])("br",null,null,-1)),be={class:"copyButtonDiv",style:{display:"inline-block"}},ue=l(()=>Object(s["e"])("br",null,null,-1)),ye={key:0,style:{color:"#0f8","font-size":"20px",position:"absolute","maring-top":"45px",width:"120px","margin-left":"-58px"}},me=l(()=>Object(s["e"])("br",null,null,-1));function fe(e,t,a,i,l,o){const c=Object(s["m"])("Header");return Object(s["j"])(),Object(s["d"])("div",r,[1==a.state.stage?(Object(s["j"])(),Object(s["d"])("div",n,[Object(s["q"])(Object(s["e"])("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>a.state.colorMode=e),style:{"margin-right":"10px"},onInput:t[1]||(t[1]=e=>l.c.focus())},h,544),[[s["o"],a.state.colorMode]]),!a.state.author||1!=a.state.stage||a.state.challengerJoined?(Object(s["j"])(),Object(s["d"])("div",p,[a.state.singlePlayerMode?Object(s["c"])("",!0):Object(s["q"])((Object(s["j"])(),Object(s["d"])("input",{key:0,type:"search","onUpdate:modelValue":t[2]||(t[2]=e=>a.state.playerName=e),style:{width:"150px","font-size":"18px","margin-right":"10px",background:"#1236"},onInput:t[3]||(t[3]=e=>o.pollServer(1))},null,544)),[[s["p"],a.state.playerName]]),a.state.author?(Object(s["j"])(),Object(s["d"])("div",d,[Object(s["e"])("span",{ref:"gamelink",class:"gamelink",innerHTML:o.processedGameLink,style:{"font-size":".75em",background:"#001",display:"inline-block"}},null,8,b),Object(s["e"])("div",u,[Object(s["e"])("button",{style:{"font-size":"14px","margin-left":"5px",padding:"5px","padding-left":"30px","padding-right":"1=5px","margin-top":"0px","background-image":"url(http://srmcgann.github.io/assets/19npcK.png)","background-repeat":"no-repeat","background-position":"5px 2px","text-shadow":"1px 1px 2px #000","background-size":"20px 20px",border:"1px solid #8888","background-color":"#6fa8","border-radius":"8px","padding-top":"3"},onClick:t[4]||(t[4]=e=>o.copy()),class:Object(s["h"])({copied:a.state.linkCopied})},"copy",2),y,a.state.linkCopied?(Object(s["j"])(),Object(s["d"])("span",m,"link copied!")):Object(s["c"])("",!0)])])):Object(s["c"])("",!0)])):Object(s["c"])("",!0)])):Object(s["c"])("",!0),Object(s["g"])(c,{state:a.state},null,8,["state"]),Object(s["e"])("div",f,[Object(s["e"])("canvas",g,null,512),a.state.stage&&2!=a.state.stage?Object(s["c"])("",!0):(Object(s["j"])(),Object(s["d"])("div",{key:0,class:Object(s["h"])(["inputForm",{noyellow:"cyberpunk"==a.state.colorMode}])},[Object(s["e"])("div",j,[a.state.stage?(Object(s["j"])(),Object(s["d"])("div",O,[Object(s["f"])(" You've been"),k,x,w,Object(s["f"])("Tetris match!"),N])):Object(s["c"])("",!0),a.state.stage?Object(s["c"])("",!0):(Object(s["j"])(),Object(s["d"])("div",v,[Object(s["f"])(" create a multiplayer"),S,D,T])),P,Object(s["q"])(Object(s["e"])("input",{type:"search",maxlength:"16",placeholder:"enter your name","onUpdate:modelValue":t[5]||(t[5]=e=>a.state.playerName=e),autocomplete:"off",ref:"userNameField",onKeyup:t[6]||(t[6]=Object(s["r"])(e=>a.state.stage?o.joinGame():o.createGame(),["enter"]))},null,544),[[s["p"],a.state.playerName]]),M,a.state.playerName?(Object(s["j"])(),Object(s["d"])("button",{key:2,class:Object(s["h"])(["createGameButton",{disabled:!a.state.playerName.length}]),disabled:!a.state.playerName.length,style:{position:"absolute",width:"250px",transform:"translatex(-50%)","margin-top":"20px"},onClick:t[7]||(t[7]=e=>a.state.stage?o.joinGame():o.createGame()),innerHTML:a.state.stage?"join game":"create game"},null,10,C)):Object(s["c"])("",!0),A,B,Object(s["f"])("or"),J,G,Object(s["e"])("button",{onClick:t[8]||(t[8]=e=>o.launchSinglePlayer())},[Object(s["f"])("play single"),R,Object(s["f"])("player mode")])])],2)),a.state.gameActuallyPlaying?Object(s["c"])("",!0):(Object(s["j"])(),Object(s["d"])("div",I,[a.state.author||1!=a.state.stage?Object(s["c"])("",!0):(Object(s["j"])(),Object(s["d"])("div",L,[o.countdown<=0?(Object(s["j"])(),Object(s["d"])("div",K,[Object(s["e"])("div",z,[Object(s["e"])("span",$,[Object(s["f"])(Object(s["n"])(o.playerJoinedCount),1),H]),Object(s["f"])("players"),E,Object(s["f"])("have joined..."),U,Object(s["e"])("span",F,[Object(s["f"])(Object(s["n"])(Array(1+(8*l.t|0)%8).fill(" <").join("")+Array(1+(8*l.t|0)%8).fill("> ").join("")),1),q,Object(s["f"])(" waiting for the"),W,V,_,Object(s["f"])("to start the game"),Y,Object(s["f"])(" "+Object(s["n"])(Array(1+(8*l.t|0)%8).fill(" <").join("")+Array(1+(8*l.t|0)%8).fill("> ").join("")),1)])])])):(Object(s["j"])(),Object(s["d"])("div",X,[Object(s["e"])("div",{class:Object(s["h"])({noyello:"cyberpunk"==a.state.colorMode}),style:Object(s["i"])("transform: scale("+(.1+l.t%1*20)+"); opacity: "+(1-l.t%1)),innerHTML:o.countdown},null,14,Q)]))])),a.state.author&&1==a.state.stage&&a.state.challengerJoined?(Object(s["j"])(),Object(s["d"])("div",Z,[o.countdown<=0?(Object(s["j"])(),Object(s["d"])("div",ee,[Object(s["f"])(Object(s["n"])(o.playerJoinedCount)+" players have joined...",1),te,Object(s["e"])("button",{style:{background:"linear-gradient(135deg, #0ff, #80f)",color:"#000","margin-top":"10px"},onClick:t[9]||(t[9]=e=>o.playGame()),ref:"startGameButton"},"start game",512)])):(Object(s["j"])(),Object(s["d"])("div",ae,[Object(s["e"])("div",{style:Object(s["i"])("transform: scale("+(.1+l.t%1*20)+"); opacity: "+(1-l.t%1)),innerHTML:o.countdown},null,12,se)]))])):Object(s["c"])("",!0)])),1!=a.state.stage||a.state.alive?Object(s["c"])("",!0):(Object(s["j"])(),Object(s["d"])("div",ie,[Object(s["e"])("div",le,[Object(s["f"])(" You've been defeated!"),re,ne,Object(s["e"])("button",{onClick:t[10]||(t[10]=e=>o.reload())},"re-start")])])),a.state.author&&1==a.state.stage&&!a.state.challengerJoined?(Object(s["j"])(),Object(s["d"])("div",oe,[Object(s["f"])(" share this link with"),ce,Object(s["f"])("up to 3 opponents!"),he,Object(s["e"])("span",{ref:"gamelink",class:"gamelink",innerHTML:o.processedGameLink,style:{background:"#001"}},null,8,pe),de,Object(s["e"])("div",be,[Object(s["e"])("button",{style:{"font-size":"18px","margin-left":"5px",padding:"15px","padding-left":"50px","padding-right":"10px","margin-top":"10px","background-image":"url(http://srmcgann.github.io/assets/19npcK.png)","background-repeat":"no-repeat","background-position":"5px 5px","text-shadow":"1px 1px 2px #000","background-size":"40px 40px",border:"1px solid #8888","background-color":"#6fa8","border-radius":"8px"},onClick:t[11]||(t[11]=e=>o.copy()),class:Object(s["h"])({copied:a.state.linkCopied})},"copy",2),ue,a.state.linkCopied?(Object(s["j"])(),Object(s["d"])("span",ye,"link copied!")):Object(s["c"])("",!0)]),me])):Object(s["c"])("",!0)])])}const ge=e=>(Object(s["l"])("data-v-0286617c"),e=e(),Object(s["k"])(),e),je={class:"header"},Oe=["href"],ke=ge(()=>Object(s["e"])("div",{class:"headerText"},[Object(s["f"])("TETRIS"),Object(s["e"])("br"),Object(s["f"])("THE NEXT GENERATION")],-1)),xe=[ke],we={ref:"headerCanvas"};function Ne(e,t,a,i,l,r){return Object(s["j"])(),Object(s["d"])("div",je,[Object(s["e"])("a",{href:a.state.baseURL},xe,8,Oe),Object(s["e"])("canvas",we,null,512)])}var ve={name:"Header",props:["state"],data(){return{t:0,S:Math.sin,C:Math.cos,x:null,c:null}},computed:{},methods:{Draw(){let e,t,a,s,i,l,r,n,o,c,h,p,d,b,u,y,m,f,g,j,O,k,x,w,N,v=this.t,S=this.S,D=this.C,T=this.x,P=this.c;for(o=(e,t,a,i)=>{g=S(s=(x=(k=Math).atan2)(g,j)+e)*(N=(w=k.hypot)(g,j)),j=D(s)*N,j=S(s=x(j,O)+t)*(N=w(j,O)),O=D(s)*N,g=S(s=x(g,O)+a)*(N=w(g,O)),O=D(s)*N,i&&(g+=d,j+=b,O+=u)},e=[],t=6;t--;)for(a=4;a--;)e=[...e,[(i=[S(s=2*Math.PI/4*a+Math.PI/4)*2**.5/2,D(s)*2**.5/2,.5])[t%3]*(l=t<3?1:-1),i[(t+1)%3]*l,i[(t+2)%3]*l]];r=[[[-.5,-1,0],[-.5,0,0],[-.5,1,0],[.5,1,0]],[[.5,-1,0],[.5,0,0],[.5,1,0],[-.5,1,0]],[[-1,0,0],[0,0,0],[1,0,0],[0,1,0]],[[-1.5,0,0],[-.5,0,0],[.5,0,0],[1.5,0,0]],[[-.5,-1,0],[-.5,0,0],[.5,0,0],[.5,1,0]],[[.5,-1,0],[.5,0,0],[-.5,0,0],[-.5,1,0]],[[-.5,-.5,0],[.5,-.5,0],[.5,.5,0],[-.5,.5,0]]],P.width=P.clientWidth,T.fillStyle="#000",T.clearRect(0,0,n=P.width,n),T.lineJoin=T.lineCap="round",c=v,h=-v/2,p=v,d=0,b=0,u=5,r.map((t,a)=>{t.map(t=>{y=t[0],m=t[1],f=t[2],e.map((e,t)=>{if(g=e[0]+y,j=e[1]+m,O=e[2]+f,o(c*(a%2?1:-1),h*(a%2?1:-1.5),p,1),t%4||T.beginPath(),T.lineTo(g/O*100+((-3+a)*P.width/7-1e3*D(v/3)+P.width/2*99)%P.width,P.height/2+j/O*100),t%4==3){switch(this.state.colorMode){case"cyberpunk":T.strokeStyle="hsla(170,75%,50%,.8)",T.fillStyle="hsla(170,75%,50%,.3)";break;case"rainbows":T.strokeStyle=`hsla(${360/7*(a-1)},75%,50%,.8)`,T.fillStyle=`hsla(${360/7*(a-1)},75%,50%,.3)`;break}T.closePath(),T.lineWidth=4/O,T.stroke(),T.fill()}})})}),this.t+=1/60,requestAnimationFrame(this.Draw)}},mounted(){this.$nextTick(()=>{this.c=this.$refs.headerCanvas,this.x=this.c.getContext("2d"),this.t=0,this.c.width=this.c.clientWidth,this.c.height=this.c.clientHeight,this.Draw()})}},Se=(a("e31a"),a("6b0d")),De=a.n(Se);const Te=De()(ve,[["render",Ne],["__scopeId","data-v-0286617c"]]);var Pe=Te,Me={name:"Main",props:["state"],components:{Header:Pe},data(){return{t:0,S:Math.sin,C:Math.cos,x:null,currentPiece:null,swapped:!1,boardBG:new Image,tempBoard:[],initDropFreq:40,dropFreq:40,rowsCompleted:0,c:null,spaceKey:!1,leftKey:!1,upKey:!1,rightKey:!1,downKey:!1,tabKey:!1,pieceMoveTimer:0,pieceRotateTimer:0,piceMoveInterval:.15,pieceManualDropTimer:0,piecManualDropInterval:.02,B:[],G:[],R:null,nextPieceIdx:7*Math.random()|0,stage:null}},computed:{countdown(){return this.state.countdownTimer-this.t|0},playerJoinedCount(){let e=0;return e+=this.state.playerAName?1:0,e+=this.state.playerBName?1:0,e+=this.state.playerCName?1:0,e+=this.state.playerDName?1:0,e<2&&(this.state.challengerJoined=!1),e},processedGameLink(){return this.state.gameLink}},methods:{launchSinglePlayer(){this.state.singlePlayerMode=!0,this.startGame()},spawnPiece(e,t){this.tempBoard=JSON.parse(JSON.stringify(this.state.boardData));let a=this.nextPieceIdx;this.nextPieceIdx=this.B.length*Math.random()|0;let s=JSON.parse(JSON.stringify(this.B))[a].map(s=>[Math.round(e+s[0]),Math.round(t+s[1]),a]);this.canDo(s)?(this.currentPiece=s,this.state.boardData=this.state.boardData.map((e,t)=>{let a=t%10,s=(t/10|0)-6;return this.currentPiece.map(t=>{t[0]==a&&t[1]==s&&(e[0]=t[2]+1,e[1]=0)}),e})):this.state.alive=!1},checkRowCompletion(){let e;for(let t=26;t--;){e=!0;for(let a=0;a<10;++a)this.state.boardData[10*t+a][0]||(e=!1);if(e){this.rowsCompleted++,this.dropFreq=this.initDropFreq/(1+this.rowsCompleted/20),this.rowsCompleted>this.state.highScore&&(this.state.highScore=this.rowsCompleted);for(let e=0;e<10;++e)this.state.boardData[10*t+e][1]=1}}},canDo(e){let t=!0;return this.tempBoard.map((a,s)=>{let i=s%10,l=(s/10|0)-6;e.map(e=>{(e[0]==i&&e[1]==l&&a[0]||e[1]>19||e[0]<0||e[0]>9)&&(t=!1)})}),t},advancePiece(){if(!this.currentPiece)return;let e=JSON.parse(JSON.stringify(this.currentPiece)).map(e=>[Math.round(e[0]),Math.round(e[1]+1),e[2]]);this.canDo(e)?(this.currentPiece=e,this.state.boardData=JSON.parse(JSON.stringify(this.tempBoard)),this.state.boardData=this.state.boardData.map((e,t)=>{let a=t%10,s=(t/10|0)-6;return this.currentPiece.map(t=>{t[0]==a&&t[1]==s&&(e[0]=t[2]+1,e[1]=0)}),e})):(this.swapped=!1,this.state.boardData=this.state.boardData.map((e,t)=>{let a=t%10,s=(t/10|0)-6;return this.currentPiece.map(t=>{t[0]==a&&t[1]==s&&(e[0]=t[2]+1,e[1]=0)}),e}),this.currentPiece=null,this.tempBoard=JSON.parse(JSON.stringify(this.state.boardData)),this.checkRowCompletion())},syncBoard(){this.state.boardData=Array(260).fill().map(e=>[0,0]),this.dropFreq=this.initDropFreq,this.rowsCompleted=0,this.tempBoard=Array(260).fill().map(e=>[0,0])},copy(){this.state.copyToClipboard(this.$refs.gamelink)},createGame(){this.state.createGame()},joinGame(){this.state.playerNumber="",this.state.stage=1,this.state.alive=!0,this.syncBoard(),this.pollServer(),this.$nextTick(()=>this.Draw())},drawNextPiece(e,t,a,s){let i,l,r,n,o,c,h,p,d,b,u=this.t,y=this.S,m=this.C,f=this.x,g=this.c;f.lineJoin=f.lineCap="round",t+=70,o=u/4,c=-u/1.5,h=2*u;let j,O,k,x,w,N=(g.height-g.height/20)*s;p=0,d=0,b=Math.max(4,16-N/60),n=(e,t,a,s)=>{i=y(k=(O=(j=Math).atan2)(i,l)+e)*(w=(x=j.hypot)(i,l)),l=m(k)*w,l=y(k=O(l,r)+t)*(w=x(l,r)),r=m(k)*w,i=y(k=O(i,r)+a)*(w=x(i,r)),r=m(k)*w,s&&(i+=p,l+=d,r+=b)},this.B.map((s,p)=>{p==a&&s.map(a=>{let s=a[0],d=a[1],b=a[2];this.G.map((a,u)=>{if(i=a[0]+s,l=a[1]+d,r=a[2]+b,n(o*(p%2?1:-1),c*(p%2?1:-1.5),h,1),u%4||f.beginPath(),f.lineTo(e+N/4.5-100+i/r*200,t+N/8-70+l/r*200),u%4==3){switch(this.state.colorMode){case"cyberpunk":f.strokeStyle="hsla(170,75%,60%,.8)",f.fillStyle="hsla(170,75%,60%,.3)";break;case"rainbows":f.strokeStyle=`hsla(${360/7*p},75%,50%,.8)`,f.fillStyle=`hsla(${360/7*p},75%,50%,.3)`;break}f.closePath(),f.lineWidth=5/r,f.stroke(),f.fill()}})})})},drawOpponents(e,t){let a,s=this.t,i=this.S,l=(this.C,this.x),r=this.c,n=.4,o=(r.height-r.height/20)*n,c=t+o/4;if(this.state.singlePlayerMode)return l.font=o/10+'px "Varela Round"',l.fillStyle="#0f8",l.fillText("high score",e+o/4,t+o/8*2),l.fillStyle="#fff",l.fillText(this.state.highScore,e+o/2-o/32,t+o/8*3),l.fillStyle="#0f8",l.fillText("rows completed",e+o/6,t+o/8*5),l.fillStyle="#fff",void l.fillText(this.rowsCompleted,e+o/2-o/32,t+o/8*6);if(this.state.challengerJoined){let n=.2,o=(r.height-r.height/20)*n,c=t+o/4;for(let r=0;r<4;++r){let n=!0;switch(r){case 0:this.state.playerAName||(n=!1);break;case 1:this.state.playerBName||(n=!1);break;case 2:this.state.playerCName||(n=!1);break;case 3:this.state.playerDName||(n=!1);break}let h,p=(r%2+.3)*o*1.05,d=(r/2|0)*o*1.22;if(a=p+e+o/32-o/4,t=d+c,n){let n=[];switch(r){case 0:n=this.state.playerAdata.boardData;break;case 1:n=this.state.playerBdata.boardData;break;case 2:n=this.state.playerCdata.boardData;break;case 3:n=this.state.playerDdata.boardData;break}l.drawImage(this.boardBG,a,t,o/2,o);let c=o/1e3;n.map((a,r)=>{if(a[0]){let n=p+r%10*o/20+o/35-o/4,h=((r/10|0)-6)*o/20-o/35;if((r/10|0)-6>=0){switch(this.state.colorMode){case"cyberpunk":l.fillStyle=`hsla(170,75%,${50*(a[1]?a[1]-1:0)*i(50*s)+25+10*(a[0]-1)}%,.8)`;break;case"rainbows":l.fillStyle=`hsla(${360/7*(a[0]-1)},75%,${50*(a[1]?a[1]-1:0)*i(50*s)+50}%,.8)`;break}l.fillRect(e+n+c,t+h+o/40+c,o/20-2*c,o/20-2*c)}}}),l.strokeStyle="#aff6",l.lineWidth=2,l.strokeRect(a,t,o/2,o);let d,b,u=!0;switch(r){case 0:u=this.state.playerAdata.alive;break;case 1:u=this.state.playerBdata.alive;break;case 2:u=this.state.playerCdata.alive;break;case 3:u=this.state.playerDdata.alive;break}switch(u||(l.fillStyle="#f248",l.fillRect(a,t,o/2,o)),l.font=o/10+'px "Varela Round"',this.state.colorMode){case"cyberpunk":l.fillStyle="#0f8";break;case"rainbows":l.fillStyle="#ff0";break;default:l.fillStyle="#0f8"}switch(r){case 0:h=this.state.playerAName;break;case 1:h=this.state.playerBName;break;case 2:h=this.state.playerCName;break;case 3:h=this.state.playerDName;break}switch(h='"'+h+'"',l.fillStyle="#ff0",l.fillText(h,a,t-o/28),l.font=o/10+'px "Varela Round"',r){case 0:d=this.state.playerAdata.highScore;break;case 1:d=this.state.playerBdata.highScore;break;case 2:d=this.state.playerCdata.highScore;break;case 3:d=this.state.playerDdata.highScore;break}switch(l.fillStyle="#0f8",l.fillText("high",a+o/1.9,t+o/10),l.fillText("score",a+o/1.9,t+o/10*2),l.fillStyle="#fff",l.fillText(d,a+o/1.75,t+o/10*3),r){case 0:b=this.state.playerAdata.rowsCompleted;break;case 1:b=this.state.playerBdata.rowsCompleted;break;case 2:b=this.state.playerCdata.rowsCompleted;break;case 3:b=this.state.playerDdata.rowsCompleted;break}l.fillStyle="#0f8",l.fillText("current",a+o/1.9,t+o/10*6),l.fillText("rows",a+o/1.9,t+o/10*7),l.fillStyle="#fff",l.fillText(b,a+o/1.75,t+o/10*8)}else l.fillStyle="#2228",l.fillRect(a,t,o/2,o),l.strokeStyle="#8886",l.lineWidth=1,l.strokeRect(a,t,o/2,o),h="not joined",l.font=o/10+'px "Varela Round"',l.fillStyle="#888",l.fillText(h,a,t-o/28)}}else t=c,l.font=o/8+'px "Varela Round"',l.fillStyle="#fff8",l.fillText("awaiting",e+o/3.25,t+o/4),l.fillText("challenger(s)",e+o/5,t+o/2.5),l.font=o/4+'px "Varela Round"',l.fillStyle="#4688",l.fillText("["+Array((8*s|0)%8).fill(".").join("")+"]",e+o/2.1-(8*s|0)%8*.035*o,t+o/1.45)},async pollServer(e){let t={playerNumber:this.state.playerNumber,gameID:this.state.gameID,playerName:this.state.playerName,gamedata:{boardData:this.state.boardData,highScore:this.state.highScore,rowsCompleted:this.rowsCompleted,alive:this.state.alive,playerName:this.state.playerName,playerNumber:this.state.playerNumber}};await fetch(this.state.baseURL+"/sync.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(e=>e.json()).then(t=>{if(console.log(t),t)if("error - game full"==t[0])alert("OOPS! game is full... you can create a new game though!"),window.location.href=this.state.baseURL+"/";else{t[2]&&(+t[2].playing||(this.state.gameActuallyPlaying=!1),!+t[2].playing||this.state.gameActuallyPlaying||this.state.countdownTimer||(this.t=1,this.state.countdownTimer=this.t+6)),this.state.playerNumber=t[0];let a,s=t[2],i=""==s.gamedataA?[]:JSON.parse(s.gamedataA),l=""==s.gamedataB?[]:JSON.parse(s.gamedataB),r=""==s.gamedataC?[]:JSON.parse(s.gamedataC),n=""==s.gamedataD?[]:JSON.parse(s.gamedataD);switch("undefined"==typeof i.playerNumber&&(this.state.playerAName="",this.state.playerAdata={boardData:[]}),"undefined"==typeof l.playerNumber&&(this.state.playerBName="",this.state.playerBdata={boardData:[]}),"undefined"==typeof r.playerNumber&&(this.state.playerCName="",this.state.playerCdata={boardData:[]}),"undefined"==typeof n.playerNumber&&(this.state.playerDName="",this.state.playerDdata={boardData:[]}),this.state.author&&(a=i.playerName),this.state.playerNumber){case"B":a=l.playerName;break;case"C":a=r.playerName;break;case"D":a=n.playerName;break;default:this.state.author||(a="");break}this.state.playerAdata=i,this.state.playerBdata=l,this.state.playerCdata=r,this.state.playerDdata=n,("undefined"!=typeof a&&!e&&a.length&&this.t-this.state.lastNameUpdateTimer>3||this.t<3)&&(this.state.playerName=a,this.state.playerAdata=i),"undefined"!=typeof i.playerName&&(this.state.playerAName=i.playerName),"undefined"!=typeof l.playerName&&(this.state.playerBName=l.playerName),"undefined"!=typeof r.playerName&&(this.state.playerCName=r.playerName),"undefined"!=typeof n.playerName&&(this.state.playerDName=n.playerName),(l.playerNumber||r.playerNumber||n.playerNumber)&&(this.state.challengerJoined=!0),e?this.state.lastNameUpdateTimer=this.t:setTimeout(()=>{this.pollServer()},250)}})},Draw(){let e,t,a,s,i,l,r,n,o,c,h,p,d,b,u,y,m,f,g,j,O,k,x=this.t,w=this.S,N=this.C,v=this.x,S=this.c;if(r=(e,t,s,i)=>{u=w(a=(g=(f=Math).atan2)(u,y)+e)*(O=(j=f.hypot)(u,y)),y=N(a)*O,y=w(a=g(y,m)+t)*(O=j(y,m)),m=N(a)*O,u=w(a=g(u,m)+s)*(O=j(u,m)),m=N(a)*O,i&&(u+=h,y+=p,m+=d)},!this.t){for(e=6;e--;)for(t=4;t--;)this.G=[...this.G,[(s=[w(a=2*Math.PI/4*t+Math.PI/4)*2**.5/2,N(a)*2**.5/2,.5])[e%3]*(i=e<3?1:-1),s[(e+1)%3]*i,s[(e+2)%3]*i]];this.B=[[[-.5,-1,0],[-.5,0,0],[-.5,1,0],[.5,1,0]],[[.5,-1,0],[.5,0,0],[.5,1,0],[-.5,1,0]],[[-1,0,0],[0,0,0],[1,0,0],[0,1,0]],[[-1.5,0,0],[-.5,0,0],[.5,0,0],[1.5,0,0]],[[-.5,-1,0],[-.5,0,0],[.5,0,0],[.5,1,0]],[[.5,-1,0],[.5,0,0],[-.5,0,0],[-.5,1,0]],[[-.5,-.5,0],[.5,-.5,0],[.5,.5,0],[-.5,.5,0]]]}switch(v.lineJoin=v.lineCap="round",S.width=S.clientWidth,S.height=S.clientHeight,v.fillStyle="#000",v.clearRect(0,0,l=S.width,l),n=x,o=-x/2,c=x,h=0,p=0,d=40,k=S.height-S.height/20,this.state.stage){case 0:break;case 1:b=S.width/2-k/2,v.fillStyle="#011a",v.drawImage(this.boardBG,b,k/40,k/2,k),v.strokeStyle="#aff6",v.lineWidth=1,v.strokeRect(b,k/40,k/2,k);let e=k/500;if(this.state.boardData=this.state.boardData.map((t,a)=>{if(t[0]){let s=a%10*k/20,i=((a/10|0)-6)*k/20;if((a/10|0)-6>=0){switch(this.state.colorMode){case"cyberpunk":v.fillStyle=`hsla(170,75%,${50*(t[1]?t[1]-1:0)*w(50*x)+25+10*(t[0]-1)}%,.8)`;break;case"rainbows":v.fillStyle=`hsla(${360/7*(t[0]-1)},75%,${50*(t[1]?t[1]-1:0)*w(50*x)+50}%,.8)`;break}v.fillRect(b+s+e,i+k/40+e,k/20-2*e,k/20-2*e)}}if(t[1]&&(t[1]+=.018),t[1]>=2){for(let e=a+10;(e-=10)>=20;)e>=10&&(this.state.boardData[e][0]=this.state.boardData[e-10][0],this.state.boardData[e][1]=this.state.boardData[e-10][1]);t[1]=0}return t}),v.fillStyle="#102a",v.fillRect(b+k/2+k/32,k/40,k/2-k/16,k/2-k/16),v.strokeStyle="#aaf6",v.lineWidth=1,v.strokeRect(b+k/2+k/32,k/40,k/2-k/16,k/2-k/16),v.font=k**.9/12+'px "Varela Round"',v.fillStyle="#86fc",v.fillText("next piece",b+k/2+k/12+(k/2-k/16)/2.3-k/9,k/11-k/20+k/40),this.drawNextPiece(b+k/2+k/32+100,k/16+k/10-k/20,this.nextPieceIdx,1),v.fillStyle="#102a",v.fillRect(b+k/2+k/32,k/2-k/16+k/10-k/20,k/2-k/16,k/2+k/100+k/40),v.strokeStyle="#aaf6",v.lineWidth=1,v.strokeRect(b+k/2+k/32,k/2-k/16+k/10-k/20,k/2-k/16,k/2+k/64+k/40),v.fillStyle="#86fc",this.state.challengerJoined&&(v.font=k**.9/16+'px "Varela Round"',v.fillText("challengers",b+k/1.8+k/32+k/2/2.3-k/7,k/2+k/14-k/20)),this.drawOpponents(b+k/2+k/30,k/2-k/16+k/10-k/20+k/40),!(this.state.singlePlayerMode&&this.state.alive||this.state.challengerJoined&&this.state.gameActuallyPlaying&&this.state.alive)||(60*x|0)%(0|this.dropFreq)||this.advancePiece(),v.fillStyle="#2466",null!=this.currentPiece&&(this.state.singlePlayerMode&&this.state.alive||this.state.challengerJoined&&this.state.gameActuallyPlaying&&this.state.alive)){let t=JSON.parse(JSON.stringify(this.currentPiece));do{t=t.map(e=>(e[1]++,e))}while(this.canDo(t));Array(260).fill().map((a,s)=>{let i=s%10*k/20,l=((s/10|0)-6)*k/20;t.map(t=>{s%10==t[0]&&(s/10|0)-6==t[1]-1&&v.fillRect(b+i+e,l+k/40+e,k/20-2*e,k/20-2*e)})})}if(this.state.singlePlayerMode&&this.state.gameActuallyPlaying&&this.state.alive||this.state.challengerJoined&&this.state.gameActuallyPlaying&&this.state.alive)if(null!=this.currentPiece){if(this.spaceKey&&null!=this.currentPiece){do{this.currentPiece=this.currentPiece.map(e=>(e[1]++,e))}while(this.canDo(this.currentPiece));this.state.boardData=JSON.parse(JSON.stringify(this.tempBoard)),this.state.boardData=this.state.boardData.map((e,t)=>{let a=t%10,s=(t/10|0)-6;return this.currentPiece.map(t=>{t[0]==a&&t[1]-1==s&&(e[0]=t[2]+1,e[1]=0)}),e}),this.currentPiece=null,this.spaceKey=!1,this.tempBoard=JSON.parse(JSON.stringify(this.state.boardData)),this.checkRowCompletion()}if(this.leftKey&&null!=this.currentPiece&&this.pieceMoveTimer<x){let e=JSON.parse(JSON.stringify(this.currentPiece)).map(e=>(e[0]--,e));this.canDo(e)&&(this.currentPiece=e,this.pieceMoveTimer=this.t+this.piceMoveInterval)}if(this.rightKey&&null!=this.currentPiece&&this.pieceMoveTimer<x){let e=JSON.parse(JSON.stringify(this.currentPiece)).map(e=>(e[0]++,e));this.canDo(e)&&(this.currentPiece=e,this.pieceMoveTimer=this.t+this.piceMoveInterval)}if(this.downKey&&this.pieceManualDropTimer<x&&null!=this.currentPiece&&(this.advancePiece(),this.pieceManualDropTimer=this.t+this.piecManualDropInterval),this.upKey&&null!=this.currentPiece&&6!=this.currentPiece[0][2]&&this.pieceRotateTimer<x){let e,t=this.currentPiece[1][0],a=this.currentPiece[1][1],s=JSON.parse(JSON.stringify(this.currentPiece)).map(s=>{e=s[0];s[0],s[1];let i=Math.atan2(s[0]-t,s[1]-a)+Math.PI/2,l=Math.hypot(s[0]-t,s[1]-a);return s[0]=Math.round(t+w(i)*l),s[1]=Math.round(a+N(i)*l),s});if(this.canDo(s))this.currentPiece=s,this.pieceRotateTimer=this.t+2*this.piceMoveInterval;else if(e>=5){let e=0,t=!1;do{e++,s=s.map(e=>(e[0]--,e))}while(!(t=this.canDo(s))&&e<3);t&&(this.currentPiece=s,this.pieceRotateTimer=this.t+2*this.piceMoveInterval)}else if(e<=5){let e=0,t=!1;do{e++,s=s.map(e=>(e[0]++,e))}while(!(t=this.canDo(s))&&e<3);t&&(this.currentPiece=s,this.pieceRotateTimer=this.t+2*this.piceMoveInterval)}}null!=this.currentPiece&&(this.state.boardData=JSON.parse(JSON.stringify(this.tempBoard)),this.state.boardData=this.state.boardData.map((e,t)=>{let a=t%10,s=(t/10|0)-6;return this.currentPiece.map(t=>{t[0]==a&&t[1]==s&&(e[0]=t[2]+1,e[1]=0)}),e}))}else this.state.boardData.filter(e=>e[1]).length||this.spawnPiece(4,-2);this.t+=1/60,requestAnimationFrame(this.Draw);break;case 2:break}},launchGame(){this.stage=0,this.state.countdownTimer=0,this.t=0,this.pollServer(),this.$nextTick(()=>this.Draw())},startGame(){this.state.singlePlayerMode?history.pushState(0,0,this.state.baseURL+NaN+"/game"):history.pushState(0,0,this.state.baseURL+"/?i=/game/"+this.state.decToAlpha(this.state.gameID)+"/a"),this.state.stage=1,this.state.countdownTimer=0,this.t=0,this.state.singlePlayerMode?(this.state.gameActuallyPlaying=!1,this.state.countdownTimer=this.t+6):this.pollServer(),this.$nextTick(()=>this.Draw()),this.syncBoard()},playGame(){this.state.gameActuallyPlaying=!1;let e={gameID:this.state.gameID};fetch(this.state.baseURL+"/startGame.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{console.log(e),e[0]!=="started game# "+this.state.gameID&&console.log("error starting game :(")})},setupListeners(){document.getElementsByTagName("body")[0].addEventListener("keydown",e=>{switch(e.keyCode){case 9:this.tabKey=!0;break;case 37:this.leftKey=!0;break;case 38:this.upKey=!0;break;case 39:this.rightKey=!0;break;case 40:this.downKey=!0;break;case 32:this.spaceKey=!0;break}}),document.getElementsByTagName("body")[0].addEventListener("keyup",e=>{switch(this.pieceMoveTimer=0,this.pieceRotateTimer=0,e.keyCode){case 9:this.tabKey=!1;break;case 37:this.leftKey=!1;break;case 38:this.upKey=!1;break;case 39:this.rightKey=!1;break;case 40:this.downKey=!1;break;case 40:this.spaceKey=!1;break}})},reload(){this.syncBoard(),this.state.alive=!0,this.currentPiece=null,this.dropFreq=this.initDropFreq,this.rowsCompleted=0}},watch:{"state.gameActuallyPlaying"(e){e&&this.reload()},"state.gameLink"(e){e.length&&this.$nextTick(()=>{this.$nextTick(()=>this.startGame())})},countdown(e){!e&&this.playerJoinedCount>1&&(!this.state.author||1!=this.state.stage||this.state.challengerJoined)&&(this.state.gameActuallyPlaying=!0),this.state.singlePlayerMode&&!e&&(this.state.gameActuallyPlaying=!0)}},mounted(){this.c=this.$refs.mainCanvas,this.x=this.c.getContext("2d"),this.t=0,this.c.width=this.c.clientWidth,this.c.height=this.c.clientHeight,this.boardBG.src="http://srmcgann.github.io/assets/rjc4W.png",this.state.author&&(this.gameActuallyPlaying=!1),this.$nextTick(()=>{1!=this.state.stage&&this.$refs.userNameField.focus(),this.state.singlePlayerMode&&this.launchSinglePlayer()}),this.setupListeners()}};a("b8b6");const Ce=De()(Me,[["render",fe],["__scopeId","data-v-961e8868"]]);var Ae=Ce,Be={name:"App",components:{Main:Ae},data(){return{state:{gameStarted:!1,createGame:null,getGameData:null,baseURL:"http://efx.cantelope.org/b/games/tetris",gameLink:"",author:!1,receivedGameData:{},playerName:"",singlePlayerMode:!1,alive:!0,highScore:0,lastNameUpdateTimer:0,decToAlpha:null,alphaToDec:null,boardData:[],gameActuallyPlaying:!0,countdownTimer:null,actuallyStartGame:null,colorMode:Math.random()<.5?"rainbows":"cyberpunk",playerAName:"",playerBName:"",playerCName:"",playerDName:"",playerAdata:{boardData:[]},playerBdata:{boardData:[]},playerCdata:{boardData:[]},playerDdata:{boardData:[]},playerNumber:"",gameID:-1,mode:0,copyToClipboard:null,setBG:null,linkeCopied:!1,challengerJoined:!1}}},methods:{copyToClipboard(e){let t=document.createElement("input");t.style.position="absolute",t.style.opacity="0",t.setAttribute("type","text"),t.value=this.state.gameLink,document.getElementsByTagName("body")[0].appendChild(t),t.select(),t.setSelectionRange(0,99999),document.execCommand("copy"),t.parentNode.removeChild(t),this.state.linkCopied=!0,setTimeout(()=>{this.state.linkCopied=!1},1200)},alphaToDec(e){let t,a,s=0,i=0;while(""!=e)t=e[e.length-1],e=e.substring(0,e.length-1),a=t.charCodeAt(0)<58?t:t.charCodeAt(0)-(t.charCodeAt(0)>96?87:29),i+=a*62**s,s++;return i},decToAlpha(e){let t,a="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",s="";while(e)s=a[0|Math.round(62*(e/62-(t=e/62|0)))]+s,e=t;return""==s?"0":s},createGame(){let e={gamedata:{playerName:this.state.playerName,playerNumber:"A"}};fetch(this.state.baseURL+"/createGame.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{e&&(this.state.author=!0,this.state.playerNumber="A",this.state.gameID=e[0],this.state.gameLink=this.state.baseURL+"/?i=/game/"+this.decToAlpha(e[0]))})},getMode(){let e=[];if(-1!=window.location.href.indexOf("?i=")&&(e=window.location.href.split("?i=")[1].split("/")),e=e.filter(e=>e),e.length>0)switch(e[0]){case"game":this.state.gameID=this.alphaToDec(e[1]),"a"==e[2]?(this.state.author=!0,this.state.stage=1,this.state.gameLink=this.state.baseURL+"/?i=/game/"+this.decToAlpha(this.state.gameID),this.state.playerNumber="A"):e[1]&&(this.state.stage=2);break}else"game"==e[0]&&(this.state.singlePlayerMode=!0)},setBG(e){let t;switch(e){case"cyberpunk":t="http://srmcgann.github.io/assets/2clPtA.jpg",document.getElementsByTagName("body")[0].style.color="#0f8";break;case"rainbows":t="http://srmcgann.github.io/assets/1ECv2A.jpg",document.getElementsByTagName("body")[0].style.color="#ff0";break;default:t="http://srmcgann.github.io/assets/1ECv2A.jpg";break}document.getElementsByTagName("body")[0].style.backgroundImage="url("+t+")"}},mounted(){this.getMode(),this.state.setBG=this.setBG,this.state.createGame=this.createGame,this.state.decToAlpha=this.decToAlpha,this.state.alphaToDec=this.alphaToDec,this.state.getGameData=this.getGameData,this.state.copyToClipboard=this.copyToClipboard,this.state.actuallyStartGame=this.actuallyStartGame,this.setBG(this.state.colorMode)},watch:{"state.colorMode"(e){this.setBG(e)}}};a("3c5e");const Je=De()(Be,[["render",i]]);var Ge=Je;Object(s["a"])(Ge).mount("#app")},"69ab":function(e,t,a){},"98f8":function(e,t,a){},b8b6:function(e,t,a){"use strict";a("517b")},e31a:function(e,t,a){"use strict";a("98f8")}});
//# sourceMappingURL=app.ac716304.js.map